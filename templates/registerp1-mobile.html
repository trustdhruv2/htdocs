<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Dcs</title>
    <link rel="stylesheet" href="/static/spinner.css">
    <style>
        *{
            font-family: sans-serif;
        }
        html,body{
            width: 100%;
            height: 100%;
            margin: 0;
        }
        .popup{
            background-color: white;text-align: center;padding: 10px;max-width: 400px;font-size: 24px;border-radius: 0.2em;margin: 15px;
        }
        ul{
            padding-left: 20px;
            text-align: left;
            font-size: 14px;
            line-height: 30px;
        }
        .popupback{
            background-color: #000000b8;
            position: fixed;
            top: 0;
            height: 100%;
            width: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 4;
        }
        form{
            margin: 10px 0px;
        }
        form div{
            padding: 20px 0px;
            box-sizing: border-box;
        }
        .error{
            display: none;
            float: right;
            color: red;
        }
        .popup img{
            width: 60px;
        }
        .popup h1{
            font-size: 23px;
        }
        .popup p{
            font-size: 17px;
            line-height: 30px;
        }

        body{
            overflow: auto;
            box-sizing: border-box;
        }
        form .element{
            margin: 30px 0px;
        }
        form h2{
            font-size: 30px;
        }
        .tab{
            font-size: 20px;padding: 5px 0px;cursor: pointer;
        }
        .selected{
            border-bottom: 2px solid blue
        }
        form input,form select{
            width: 100%;
            box-sizing: border-box;
            border: 0;
            border-bottom: 1px solid;
            outline: none;
            font-size: 16px;
            padding: 5px;
        }
        form div .active{
            display: block;
        }
        input[type="submit"]{
            border: 0;
            cursor: pointer;
            color: white;
            background-color: blue;
            padding: 10px;
            background-color: blue;
            border-radius: 0.5em;
            width: 100%;
            font-size: 15px;
            outline: none;
        }
    </style>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body onload='initializer()'>
    <div style="display: none" class="popupback">
        <div class="lds-hourglass"></div>
    </div>
<div style="display: flex;align-items: center;width: 95%;height: 100%;box-sizing: border-box;margin: auto;">
    <div style="width: 95%;margin:auto;text-align: center;padding: 15px;box-sizing: border-box;height: 100%;">
        <div>
            <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAABmJLR0QA/wD/AP+gvaeTAAADmElEQVRoge3ZS2tdVRTA8V8eNU20oglYrNZaawVfFawd+ApIZ+oHcOA3cOzMbyDUb+BAcKyoIwcFRUFRByoqJq021Qa1NqWtSUiT9jpYJ5Dk7nPu3ufeZNL84ZJL9t7rrHXP2uuxN7vscmszNEA5U9iPu3EnxjFaja9hGVdxGX/jEjqDeHA/TOAoDguFS1jCOcxW31vR1oAxHMNDGG778Iqb+A0/YKV0cRsDDuEZ3NZibRMr+A5zJYtGCuYO4wSeKlyXyygOClf8S+b+yFVkBNN4oJVqZUxWnz9lGJFjwLBQ/t7+9Cpin4hq5/UwIseAE3bml9/KHdiL+aZJo02DeBBHCh+8ByfxnPBp+ANf4jRWC2Q9LHLG+boJTVFoDK9Uf3OZxJsiUqWYw9tYKJB5HZ+oCbFNLvQ07il40B68pV55uAuP43MR/3MYEZ6SdKW6JDQhklQJJzUrv84hvFQo+0ilUxd1BhxtGKvj+YK5LxTKHhY6JQe2MiQ2byn3Fcy9v4X8wxJ7NmXAlJrXNUDaVKHjIkhsImXA/hbC4cI2zd1Il24pA7qszOSLbZq7kaw3sK+l8NPyKsm5am4bunRLGVDamKyzKpJUkxHriWyt5TO6dEslsmPaNzrL+AxXRC0zIZT9HR/jXSy2lE384D9t/EevWqgNa/i0+mw7KRdq+3p3gq5CMGXA8g4o0pYu3VIGXNsBRdrSpVtqDyzIS/VP4FWR4tuG3mtig3+EnzPmd5XhqSjU0buJeRlviMxY0i9sZaySMS38+9ce87+3xY1SLnRJ80HTY3g9X8dsXsOjDeNL4lRvEykDOuLErI4Xy/QqYrph7JxEEVhX88+q75g+tD2Ragkf1IzdxExqoK6lXBVZNFXYLeIsnm1YX8oa3hFHjClm1TT2TQr8KzZzKlJdFEYcF71wPyziFH6sGV8RJxo3UoNNBtwQr/Vgzfg/+Eb0zlM5miaYEcVd3S8PX2s4xejlAlfUdEIV/4ni7aJoKXPzwTzex3uVjDpm8UuToJyqc0g04b2S25BovI8L1zuA26uxRaH0WXyLM3q3lfPi+KVxXm7ZPCKMOJA5v18uaPD7jeRGkY44HtyrfcuZyyy+knnwVRIGO+K1XhXpf9C9xIrYsI0+v5V+rpieFL4+iCumMyKMXi9d3O8l3zgeEQdhpWdJ65d8M/rI7IO8Zp0UrjUpwumEzdesS6J8XhBXSJcN4Jp1l11udf4HAterjhJKo6QAAAAASUVORK5CYII="/>
            <h2 style="font-size: 30px">Register</h2>
        </div>
        <div style="display: flex;justify-content: space-around;">
            <p onclick="switchtab(event)" class="tab selected" >As a Indivisual</p>
            <p onclick="switchtab(event)" class="tab" >As a Student</p>
        </div>
        <form method="POST" onsubmit="return postform()" action="/register">

        </form>
    </div>
</div>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.3.1/firebase-auth.js"></script>
    <script src="/static/javascript/firebaseinitializer.js" ></script>
    <script src="/static/javascript/popuphandler.js" ></script>
    <script src="/static/javascript/formgenerator.js" ></script>
<script>
    let formmap=[[
        {"tag":1,"type":"text","name":"username","placeholder":"Enter your username","error": ["This field is required","Username already exists"]},
        {"tag":1,"type":"email","name":"email","placeholder":"Enter your email","error": ["This field is required","Invalid email","Email already exists"]},
        {"tag":1,"type":"tel","name":"contact","placeholder":"Enter your contact","error": ["This field is required","Invalid contact","contact already exists"]},
        {"tag":3,"name":"state","options":[]},
        {"tag":1,"type":"text","name":"address","placeholder":"Enter your address","error": ["This field is required"]},
        {"tag":3,"name":"gender","options":[{"value":0,"text":"Male"},{"value":1,"text":"Female"},{"value":2,"text":"Other"}]},
        {"tag":1,"type":"password","name":"password","placeholder":"Enter your Password","error": ["This field is required","Invalid password"]},
        {"tag":1,"type":"password","name":"rpassword","placeholder":"Re-enter your password","error": ["This field is required","Passwords don\'t match"]},
        {"tag":4,"meta":["Password should be of at least 8 characters","Password should have at least 1 small case letter","Password should have at least 1 upper case letter","Password should have at least 1 digit","Password should have at least 1 special character"]},
        {"tag":2,"type":"submit","text":"Proceed"},
    ],[
        {"tag":1,"type":"text","name":"username","placeholder":"Enter your username","error": ["This field is required","Username already exists"]},
        {"tag":1,"type":"email","name":"email","placeholder":"Enter your email","error": ["This field is required","Invalid email","Email already exists"]},
        {"tag":1,"type":"tel","name":"contact","placeholder":"Enter your contact","error": ["This field is required","Invalid contact","contact already exists"]},
        {"tag":3,"name":"state","options":[]},
        {"tag":1,"type":"text","name":"address","placeholder":"Enter your address","error": ["This field is required"]},
        {"tag":3,"name":"school","options":[]},
        {"tag":3,"name":"gender","options":[{"value":0,"text":"Male"},{"value":1,"text":"Female"},{"value":2,"text":"Other"}]},
        {"tag":1,"type":"password","name":"password","placeholder":"Enter your Password","error": ["This field is required","Invalid password"]},
        {"tag":1,"type":"password","name":"rpassword","placeholder":"Re-enter your password","error": ["This field is required","Passwords don\'t match"]},
        {"tag":4,"meta":["Password should be of at least 8 characters","Password should have at least 1 small case letter","Password should have at least 1 upper case letter","Password should have at least 1 digit","Password should have at least 1 special character"]},
        {"tag":2,"type":"submit","text":"Proceed"},
    ]]
    function initializer(){
        var xhttp = new XMLHttpRequest();
        document.getElementsByClassName("popupback")[0].style.display = "flex"
        xhttp.onreadystatechange = function () {
            if (this.readyState == 4 && this.status == 200) {
                document.getElementsByClassName("popupback")[0].style.display = "none"
                let data=JSON.parse(this.responseText)
                formmap[0][3]["options"]=data.states
                formmap[1][3]["options"]=data.states
                formmap[1][5]["options"]=data.schools
                new formgenerator(document.getElementsByTagName(`form`)[0],`{% csrf_token %}`).pushform(formmap[0])
            }
        };
        xhttp.open("GET", "/getschools", true);
        xhttp.send();
    }
    function phonevalidation(inputtxt) {
          let phoneno = /^\d{10}$/;
          if(inputtxt.match(phoneno)){
              return true;
          }else {
              return false;
          }
    }
    function CheckPassword(inputtxt) {
        var passw = /^(?=.*\d)(?=.*[a-z])(?=.*[A-Z]).{6,}$/;
        if(inputtxt.match(passw))
        {
        return true;
        }
        else
        {
        return false;
        }
    }
    function ValidateEmail(mail){
     if (/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9-]+(?:\.[a-zA-Z0-9-]+)*$/.test(mail)){
        return true
     }
     return false
    }
    function validate(){
        let validated=true
        let form=document.getElementsByTagName("form")[0]
        for(let i=0;i<document.getElementsByClassName("error").length;i++){
            document.querySelectorAll(".error")[i].className="error"
        }
        for(let i=1;i<form.length;i++){
            if(form[i].value==""&& form[i].parentElement.children.length>1){
                form[i].parentElement.children[1].className="error active"
                validated=false
            }
        }
        if(form[2].value!="" && !ValidateEmail(form[2].value) ){
            form[2].parentElement.children[2].className="error active"
            validated=false
        }
        if(form[3].value!="" && !phonevalidation(form[3].value) ){
            form[3].parentElement.children[2].className="error active"
            validated=false
        }
        if(!CheckPassword(form[form.length-3].value)){
            form[form.length-3].parentElement.children[2].className="error active"
            validated=false
        }
        if(form[form.length-2].value!=form[form.length-3].value){
            form[form.length-2].parentElement.children[2].className="error active"
            validated=false
        }
        return validated
    }
    var current=0
      function switchtab(e){
        if(current==0){
            current=1
        }else{
            current=0
        }
        for(let i=0;i<document.getElementsByClassName("tab").length;i++){
            document.getElementsByClassName("tab")[i].className="tab"
        }
        e.target.className="tab selected"
        new formgenerator(document.getElementsByTagName("form")[0],'{% csrf_token %}').pushform(formmap[current])
      }

    function postform(){
        if(validate()) {
            let formdata = new FormData(document.getElementsByTagName("form")[0])
            formdata.append("mode",current)
            var xhttp = new XMLHttpRequest();
            document.getElementsByClassName("popupback")[0].style.display = "flex"
            xhttp.onreadystatechange = function () {
                if (this.readyState == 4 && this.status == 200) {
                    document.getElementsByClassName("popupback")[0].style.display = "none"
                    let data=JSON.parse(this.responseText)
                    console.log(data)
                    if(data.code==200){
                        firebase.auth().sendSignInLinkToEmail(data["email"], actionCodeSettings)
                        generatepopup("For verification purpose a verification link is sent to "+data["email"],"Verification")
                    }else{
                        if(data.code==300){
                            document.getElementsByTagName("form")[0][2].parentElement.children[3].className="error active"
                        }else if(data.code==350){
                            document.getElementsByTagName("form")[0][1].parentElement.children[2].className="error active"
                        }else if(data.code==370){
                            document.getElementsByTagName("form")[0][3].parentElement.children[3].className="error active"
                        }else{
                            generatepopup("Unable to proceed registration process.Kindly refresh your page and try again")
                        }
                    }
                }
            };
            xhttp.open("POST", "/verifyuser", true);
            xhttp.send(formdata);
        }
        return false;
    }
</script>
</body>
</html>